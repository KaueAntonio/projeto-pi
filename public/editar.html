<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editar</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css"
      integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7"
      crossorigin="anonymous"
    />
    <script
      src="https://kit.fontawesome.com/ea8cfd2902.js"
      crossorigin="anonymous"
    ></script>
    <link rel="icon" href="./Imagens/logo.png" />
    <link rel="stylesheet" href="site.css" />
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  </head>

  <body
    data-spy="scroll"
    data-target=".navbar"
    data-offset="50"
    onload="validarSessao()"
  >
    <header>
      <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container">
          <img
            id="iconesumir"
            class="icone"
            src="./Imagens/Icone-depositphotos-bgremover.png"
            alt=""
          />
          <a class="navbar-brand" href="#"><img src="" alt="" /></a>
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <img
              class="icone"
              src="./Imagens/Icone-depositphotos-bgremover.png"
              alt=""
            />
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="align">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ml-lg-auto">
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#home"
                    >Home <span class="sr-only">(current)</span></a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#quemsomos"
                    >Quem Somos</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#nossavisao"
                    >Nosso Objetivo</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#faleconosco"
                    >Fale Conosco</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#resultados"
                    >Avaliações</a
                  >
                </li>
                <li class="nav-item">
                  <div class="dropdown">
                    <button
                      class="btn-conta dropdown-toggle"
                      id="dropdownMenuButton"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false"
                    >
                      Conta
                    </button>
                    <div
                      class="dropdown-menu"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <a
                        id="hrefLogin"
                        style="display: none"
                        class="dropdown-item"
                        href="./login.html"
                        >Login</a
                      >
                      <a
                        id="hrefEditar"
                        style="display: none"
                        class="dropdown-item"
                        href="./editar.html"
                        >Editar</a
                      >
                      <a
                        id="hrefSair"
                        style="display: none"
                        class="dropdown-item"
                        onclick="botaoCadastro(sessionStorage.ESTADO_PAGE)"
                        href="./index.html"
                        >Sair</a
                      >
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <section class="cadastro" id="faleconosco">
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <div class="headertextoCadastro text-center">
              <h2
                data-aos="fade-up"
                data-aos-delay="0"
                data-aos-duration="1000"
              >
                Editar
              </h2>
              <p
                data-aos="fade-up"
                data-aos-delay="100"
                data-aos-duration="1000"
              >
                Altere seus dados de conta.
              </p>
            </div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="offset-sm-2 col-sm-8">
            <form
              action=""
              data-aos="fade-up"
              data-aos-delay="500"
              data-aos-duration="1000"
              class="register-form"
              id="form_cadastro"
            >
              <div class="form-group">
                <label for="">CNPJ</label>
                <input
                  name="cnpj"
                  type="text"
                  placeholder="cnpj"
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="">Nome</label>
                <input
                  name="nome"
                  type="text"
                  placeholder="Usuario"
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="">Senha</label>
                <input
                  name="senha"
                  type="password"
                  placeholder="******"
                  class="form-control"
                />
                <input
                  name="idEmpresa"
                  id="id_empresa"
                  type="number"
                  style="display: none"
                />
              </div>
              <div class="form-group">
                <label for="">Confirmar senha</label>
                <input
                  name="confirmacao-senha"
                  type="password"
                  placeholder="******"
                  class="form-control"
                />
              </div>
            </form>
            <div class="botoes">
              <div class="form-group text-center">
                <button class="btn-editar" onclick="acao('editar')">
                  Editar
                </button>
              </div>
              <div class="alinhamentoExcluir">
                <p>
                  <a class="botaoExcluir" onclick="acao('excluir')"
                    >Excluir Conta</a
                  >
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        id="resultados"
        style="
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          margin-top: 30px;
        "
        data-aos="fade-up"
        data-aos-delay="500"
        data-aos-duration="1000"
      ></div>
    </section>
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <ul class="sci">
              <li>
                <a href="https://www.facebook.com/"
                  ><i class="fab fa-facebook"></i
                ></a>
              </li>
              <li>
                <a href="https://mail.google.com/mail/"
                  ><i class="fa fa-google-plus"></i
                ></a>
              </li>
              <li>
                <a href="https://www.linkedin.com/"
                  ><i class="fa fa-linkedin"></i
                ></a>
              </li>
              <li>
                <a href="https://www.instagram.com/ "
                  ><i class="fa fa-instagram"></i
                ></a>
              </li>
            </ul>
            <p class="crypt">
              <a href="#">Copyright (C) Site - Todos os Direitos Reservados</a>
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>

    <script type="text/javascript">
      $(document).scroll(function () {
        $(".navbar").toggleClass(
          "scrolled",
          $(this).scrollTop() > $(".navbar").height()
        );
      });
    </script>
  </body>
</html>
<script>
  var rota;
  var nome;
  var senha;
  var confirmacaoSenha;
  var idEmpresa;

  function validacao() {
    if (nome == "" || senha == "" || confirmacaoSenha == "") {
      window.alert("Preencha todos os campos para prosseguir!");
      if (nome == "") {
        console.log("nome está em branco");
      }
      if (senha == "") {
        console.log("senha está em branco");
      }
      if (confirmacaoSenha == "") {
        console.log("confirmacaoSenha está em branco");
      }
      return false;
    }

    if (senha != confirmacaoSenha) {
      window.alert("As senhas inseridas devem ser iguais para prosseguir!");
      return false;
    }
  }

  function acao(acao) {
    if (acao == "editar") {
      rota = "editar";
      validacao();
    } else {
      let verificacao = confirm("Tem Certeza Que Deseja Excluir a Conta?");

      if (verificacao) {
        rota = "excluir";
      } else {
        return false;
      }
    }

    var formulario = new URLSearchParams(
      new FormData(document.getElementById("form_cadastro"))
    );

    nome = formulario.get("nome");
    cnpj = formulario.get("cnpj");
    senha = formulario.get("senha");
    confirmacaoSenha = formulario.get("confirmacao-senha");
    idEmpresa = formulario.get("idEmpresa");

    fetch(`/empresa/${rota}`, {
      method: "POST",
      body: formulario,
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          if (rota == "excluir") {
            alert("Conta Excluida!!");
            sessionStorage.ESTADO_PAGE = "deslogado";
            sessionStorage.EMAIL_USUARIO = undefined;
            sessionStorage.NOME_USUARIO = undefined;
            sessionStorage.ID_USUARIO = undefined;
            window.location = "index.html";
          } else {
            alert("Conta Editada!");

            window.location = "index.html";
          }
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

  id_empresa.value = sessionStorage.ID_USUARIO;

  function validarSessao() {
    if (sessionStorage.ESTADO_PAGE == "logado") {
      hrefLogin.style.display = "none";
      hrefSair.style.display = "block";
      hrefEditar.style.display = "block";
    } else {
      hrefLogin.style.display = "block";
      hrefSair.style.display = "none";
      hrefEditar.style.display = "none";
      alert("Não Há Usuário Logado!");
      window.location = 'index.html';
    }
  }

  function botaoCadastro(estado) {
    if (estado == "logado") {
      sessionStorage.ESTADO_PAGE = "deslogado";
      sessionStorage.EMAIL_USUARIO = undefined;
      sessionStorage.NOME_USUARIO = undefined;
      sessionStorage.ID_USUARIO = undefined;
      validarSessao();
      alert("Login Encerrado");
      window.location.href = "login.html";
    } else {
      window.location.href = "login.html";
    }
  }
</script>
