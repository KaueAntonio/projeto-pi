<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Operações</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css"
      integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7"
      crossorigin="anonymous"
    />
    <script
      src="https://kit.fontawesome.com/ea8cfd2902.js"
      crossorigin="anonymous"
    ></script>
    <link rel="icon" href="./Imagens/logo.png" />
    <link rel="stylesheet" href="site.css" />
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <!-- Start of  Zendesk Widget script -->
    <script
      id="ze-snippet"
      src="https://static.zdassets.com/ekr/snippet.js?key=76a02d93-e792-4874-accf-3433c092ca07"
    ></script>
    <!-- End of  Zendesk Widget script -->
  </head>

  <body
    data-spy="scroll"
    data-target=".navbar"
    data-offset="50"
    onload="validarSessao()"
  >
    <header>
      <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container">
          <img
            id="iconesumir"
            class="icone"
            src="./Imagens/Icone-depositphotos-bgremover.png"
            alt=""
          />
          <a class="navbar-brand" href="#"><img src="" alt="" /></a>
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <img
              class="icone"
              src="./Imagens/Icone-depositphotos-bgremover.png"
              alt=""
            />
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="align">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ml-lg-auto">
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#home"
                    >Home <span class="sr-only">(current)</span></a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#quemsomos"
                    >Quem Somos</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#nossavisao"
                    >Nosso Objetivo</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#faleconosco"
                    >Fale Conosco</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./index.html#resultados"
                    >Avaliações</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./loginPainel.html">Painel</a>
                </li>
                <li class="nav-item">
                  <div class="dropdown">
                    <button
                      class="btn-conta dropdown-toggle"
                      id="dropdownMenuButton"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false"
                    >
                      Conta
                    </button>
                    <div
                      class="dropdown-menu"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <a
                        id="hrefLogin"
                        style="display: none"
                        class="dropdown-item"
                        href="./login.html"
                        >Login</a
                      >
                      <a
                        id="hrefEditar"
                        style="display: none"
                        class="dropdown-item"
                        href="./editar.html"
                        >Editar</a
                      >
                      <a
                        id="hrefOperacao"
                        style="display: none"
                        class="dropdown-item"
                        href="./operacao.html"
                        >Operações</a
                      >

                      <a
                        id="hrefSair"
                        style="display: none"
                        class="dropdown-item"
                        onclick="botaoCadastro(sessionStorage.ESTADO_PAGE)"
                        href="./index.html"
                        >Sair</a
                      >
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <section class="cadastro" id="faleconosco">
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <div class="headertextoCadastro text-center">
              <h2
                data-aos="fade-up"
                data-aos-delay="0"
                data-aos-duration="1000"
              >
                Operações
              </h2>
              <p
                data-aos="fade-up"
                data-aos-delay="100"
                data-aos-duration="1000"
              >
                <a
                  id="bAdicionar"
                  class="botaoExcluir"
                  onclick="estado('adicionar')"
                  >Adicionar</a
                >
                <a id="bEditar" class="botaoExcluir" onclick="estado('editar')"
                  >Editar</a
                >
                <a
                  id="bExcluir"
                  class="botaoExcluir"
                  onclick="estado('excluir')"
                  >Excluir</a
                >
              </p>
            </div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="offset-sm-2 col-sm-8">
            <form
              action=""
              data-aos="fade-up"
              data-aos-delay="500"
              data-aos-duration="1000"
              class="register-form"
              id="form_operacao"
            ><div class="form-group" id="select_nome">
                <label for="">Selecione A Operação</label>
                <select
                name="selectNome"
                id="selectNome"
                type="text"
                placeholder="Bradesco"
                class="form-control">
                <option value="0">Selecione Uma Operação</option>
                </select>
              </div>
              <div class="form-group">
                <label for="">Nome Da Operação</label>
                <input
                  name="nome"
                  type="text"
                  placeholder="Bradesco"
                  class="form-control"
                />
              </div>
              <div id="label_localidade" class="form-group">
                <label for="">Localidade</label>
                <input
                  name="localidade"
                  type="text"
                  placeholder="5º Andar"
                  class="form-control"
                />
              </div>
              <div id="label_nomeGerente" class="form-group">
                <label for="">Nome Do Gerente</label>
                <input
                  name="nome_gerente"
                  type="text"
                  placeholder="Gerente"
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="">Email Do Gerente</label>
                <input
                  name="email_gerente"
                  type="text"
                  placeholder="Gerente"
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label for="">Senha Do Gerente</label>
                <input
                  name="senha_gerente"
                  type="password"
                  placeholder="******"
                  class="form-control"
                />
                <input
                  name="idEmpresa"
                  id="id_empresa"
                  type="number"
                  style="display: none"
                />
              </div>
            </form>
            <div class="botoes">
              <div class="form-group text-center">
                <button class="btn-editar" onclick="confirmar()">
                  Confirmar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        id="resultados"
        style="
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          margin-top: 30px;
        "
        data-aos="fade-up"
        data-aos-delay="500"
        data-aos-duration="1000"
      ></div>
    </section>
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <ul class="sci">
              <li>
                <a href="https://www.facebook.com/"
                  ><i class="fab fa-facebook"></i
                ></a>
              </li>
              <li>
                <a href="https://mail.google.com/mail/"
                  ><i class="fa fa-google-plus"></i
                ></a>
              </li>
              <li>
                <a href="https://www.linkedin.com/"
                  ><i class="fa fa-linkedin"></i
                ></a>
              </li>
              <li>
                <a href="https://www.instagram.com/ "
                  ><i class="fa fa-instagram"></i
                ></a>
              </li>
            </ul>
            <p class="crypt">
              <a href="#">Copyright (C) Site - Todos os Direitos Reservados</a>
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>

    <script type="text/javascript">
      $(document).scroll(function () {
        $(".navbar").toggleClass(
          "scrolled",
          $(this).scrollTop() > $(".navbar").height()
        );
      });
    </script>
  </body>
</html>
<script>

  function confirmar() {
    if (sessionStorage.ESTADO_OPERACAO == "editar") {
      editar();
    } else if (sessionStorage.ESTADO_OPERACAO == "excluir") {
      excluir();
    } else if (sessionStorage.ESTADO_OPERACAO == "adicionar") {
      adicionar();
    }
  }

  id_empresa.value = sessionStorage.ID_USUARIO;
  console.log(sessionStorage.ID_USUARIO);
  function validarSessao() {
    if (sessionStorage.ESTADO_PAGE == "logado") {
      hrefLogin.style.display = "none";
      hrefSair.style.display = "block";
      hrefEditar.style.display = "block";
      hrefOperacao.style.display = "block";
    } else {
      hrefLogin.style.display = "block";
      hrefSair.style.display = "none";
      hrefEditar.style.display = "none";
      hrefOperacao.style.display = "none";
    }
  }

  function botaoCadastro(estado) {
    if (estado == "logado") {
      sessionStorage.ESTADO_PAGE = "deslogado";
      sessionStorage.EMAIL_USUARIO = undefined;
      sessionStorage.NOME_USUARIO = undefined;
      sessionStorage.ID_USUARIO = undefined;
      validarSessao();
      alert("Login Encerrado");
      window.location.href = "login.html";
    } else {
      window.location.href = "login.html";
    }
  }

  function estado(estado) {
    sessionStorage.ESTADO_OPERACAO = estado;
    estiloEstado();
  }

  sessionStorage.ESTADO_OPERACAO = "adicionar";

  function estiloEstado() {
    if (sessionStorage.ESTADO_OPERACAO == "adicionar") {
      bAdicionar.style.borderBottom = "2px solid black";
      bEditar.style.borderBottom = "none ";
      bExcluir.style.borderBottom = "none";
      label_nomeGerente.style.display = "block";
      label_localidade.style.display = "block";
      select_nome.style.display = 'none';
    } else if (sessionStorage.ESTADO_OPERACAO == "editar") {
      bAdicionar.style.borderBottom = "none";
      bEditar.style.borderBottom = "2px solid black";
      bExcluir.style.borderBottom = "none";
      label_nomeGerente.style.display = "block";
      label_localidade.style.display = "block";
      select_nome.style.display = 'block';
    } else if (sessionStorage.ESTADO_OPERACAO == "excluir") {
      bAdicionar.style.borderBottom = "none";
      bEditar.style.borderBottom = "none";
      bExcluir.style.borderBottom = "2px solid black";
      label_nomeGerente.style.display = "none";
      label_localidade.style.display = "none";
      select_nome.style.display = 'none';
    }
  }

  estiloEstado();

  function editar() {
    var formulario = new URLSearchParams(
      new FormData(document.getElementById("form_operacao"))
    );

    var nome_operacao = formulario.get("nome");
    var localidade = formulario.get("localidade");
    var email_gerente = formulario.get("email_gerente");
    var nome_gerente = formulario.get("nome_gerente");
    var senha_gerente = formulario.get("senha_gerente");
    var id_empresa = formulario.get("idEmpresa");
    var select = formulario.get("selectNome");

    if (
        nome_operacao == "" ||
      localidade == "" ||
      email_gerente == "" ||
      nome_gerente == "" ||
      senha_gerente == "" ||
      select == ""
    ) {
      window.alert("Preencha todos os campos para prosseguir!");
      if (nome_operacao == "") {
        alert("nome da operação está em branco");
        return false;
      }
      if (localidade == "") {
        alert("localidade está em branco");
        return false;
      }
      if (email_gerente == "") {
        alert("email do gerente está em branco");
        return false;
      }
      if (nome_gerente == "") {
        alert("nome do gerente está em branco");
        return false;
      }
      if (senha_gerente == "") {
        alert("senha do gerente está em branco");
        return false;
      }
      if (select == "0") {
        alert("Selecione Uma Operação!");
        return false;
      }
      if (email_gerente.indexOf("@") && email_gerente.indexOf(".com")) {
        alert("email incorreto!!");
        return false;
      }
      return false;
    }
    fetch('/operacao/editar', {
      method: "POST",
      body: formulario,
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            alert("Operação Editada!");
          window.location = "index.html";

        } else {
            alert('Houve um erro ao editar!');
          throw "Houve um erro ao tentar realizar a edição!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }
  function adicionar() {
    var formulario = new URLSearchParams(
      new FormData(document.getElementById("form_operacao"))
    );

    var nome_operacao = formulario.get("nome");
    var localidade = formulario.get("localidade");
    var email_gerente = formulario.get("email_gerente");
    var nome_gerente = formulario.get("nome_gerente");
    var senha_gerente = formulario.get("senha_gerente");
    var id_empresa = formulario.get("idEmpresa");

    if (
        nome_operacao == "" ||
      localidade == "" ||
      email_gerente == "" ||
      nome_gerente == "" ||
      senha_gerente == ""
    ) {
      window.alert("Preencha todos os campos para prosseguir!");
      if (nome_operacao == "") {
        alert("nome da operação está em branco");
        return false;
      }
      if (localidade == "") {
        alert("localidade está em branco");
        return false;
      }
      if (email_gerente == "") {
        alert("email do gerente está em branco");
        return false;
      }
      if (nome_gerente == "") {
        alert("nome do gerente está em branco");
        return false;
      }
      if (senha_gerente == "") {
        alert("senha do gerente está em branco");
        return false;
      }
      if (email_gerente.indexOf("@") && email_gerente.indexOf(".com")) {
        alert("email incorreto!!");
        return false;
      }
      return false;
    }
    fetch('/operacao/adicionar', {
      method: "POST",
      body: formulario,
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            alert("Operação Adicionada!");
          window.location = "index.html";

        } else {
            alert('Houve um erro ao adicionar!');
          throw "Houve um erro ao tentar realizar a adição!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function excluir() {
    var formulario = new URLSearchParams(
      new FormData(document.getElementById("form_operacao"))
    );

    var nome_operacao = formulario.get("nome");
    var localidade = formulario.get("localidade");
    var email_gerente = formulario.get("email_gerente");
    var nome_gerente = formulario.get("nome_gerente");
    var senha_gerente = formulario.get("senha_gerente");
    var id_empresa = formulario.get("idEmpresa");

    if (
        nome_operacao == "" ||
      email_gerente == "" ||
      senha_gerente == ""
    ) {
      window.alert("Preencha todos os campos para prosseguir!");
      if (nome_operacao == "") {
        alert("nome da operação está em branco");
        return false;
      }
      if (localidade == "") {
        alert("localidade está em branco");
        return false;
      }
      if (email_gerente == "") {
        alert("email do gerente está em branco");
        return false;
      }
      if (nome_gerente == "") {
        alert("nome do gerente está em branco");
        return false;
      }
      if (senha_gerente == "") {
        alert("senha do gerente está em branco");
        return false;
      }
      if (email_gerente.indexOf("@") && email_gerente.indexOf(".com")) {
        alert("email incorreto!!");
        return false;
      }
      return false;
    }
    fetch('/operacao/excluir', {
      method: "POST",
      body: formulario,
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            alert("Se As Opções Forem Corretas, A Operação será Excluída!");
          window.location = "index.html";

        } else {
            alert('Houve um erro ao excluir!');
          throw "Houve um erro ao tentar realizar a edição!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  fetch("/operacao/listar", {
        method: "GET",
    }).then(function (resposta) {


        resposta.json().then(function (data) {

let len = data.length;
for (let i = 0; i <= len; i++) {
    let arquivo = data[i];
    if (arquivo.fk_empresa == sessionStorage.ID_USUARIO){
        selectNome.innerHTML += (`<option value=${arquivo.id_operacao}>${arquivo.nome_operacao}</option>`);
    }
}
});
}).catch(function (error) {
console.error(`ERROR`, error);
});

</script>
